<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div style="display: flex; align-items: center; gap: 10px;">
        <h2>CODIGO: </h2>
        <p class="socket-id" style="font-size: 1em;"></p>
    </div>

    <div class="send-file">
        <input type="file" name="" id="" class="file">
        <button type="submit" class="send">ENVIAR</button>
    </div>

    <div id="receivedFiles"></div>

</body>

<script src="/socket.io/socket.io.js"></script>
<script>
    let socket = io();
    let user_id = "";
    socket.on("connect", ()=>{
        socket.on('get-id', id=>{
            document.querySelector(".socket-id").textContent = id;
            socket.emit("user-connected", id);
            user_id = id;
        });
    });

    document.querySelector(".send").addEventListener("click", ()=>{
        let files = document.querySelector(".file");
        let file = files.files[0];

        if(!file){
            alert("Debe seleccionar un archivo.");
            return;
        }

        const reader = new FileReader();
        reader.onload = e=>{
            const content = e.target.result;
            const filename = file.name;
            socket.emit("upload-file", {filename, content}, user_id);
        }

        reader.readAsBinaryString(file);
    });

    socket.on("received-file", (data) => {
        console.log(data.filename);
        console.log(data);
        const receivedFilesDiv = document.getElementById('receivedFiles');
        const fileLink = document.createElement('a');
        // Utilizar el atributo href para el enlace directo al archivo
        fileLink.href = `/downloads/${data.filename.replace(" ", "_")}`; // Aseg√∫rate de configurar correctamente la ruta
        console.log(`/downloads/${data.filename.replace(" ", "_")}`);
        fileLink.download = data.filename;
        fileLink.textContent = `Descargar archivo: ${data.filename.replace(" ", "_")}`;
        receivedFilesDiv.appendChild(fileLink);
    });
    
</script>

</html>